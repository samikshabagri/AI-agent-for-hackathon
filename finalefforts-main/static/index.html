<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maritime Virtual Assistant</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-1:#030817; /* deep navy */
      --bg-2:#0b1024; /* indigo */
      --ink:#e6ebff;
      --muted:#aab2d6;
      --brand:#5cc8ff; /* azure */
      --brand-2:#7b7dff; /* violet */
      --accent:#54f2c6; /* teal */
      --card:#0e1330cc;
      --stroke:#1d2450;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:var(--ink);
      background: radial-gradient(1200px 800px at 70% -10%, #1b2a74 0%, transparent 60%),
                  radial-gradient(900px 600px at 10% 10%, #0a4a63 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg-1), var(--bg-2));
      overflow-x:hidden;
    }

    /* soft grain */
    .noise{position:fixed; inset:0; pointer-events:none; opacity:.06; mix-blend:overlay;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity=".5"/></svg>');
      background-size:160px 160px; z-index:1}

    /* big behind-the-scenes watermark */
    .watermark{
      position:fixed; inset:0; display:grid; place-items:center; pointer-events:none; z-index:0;
      font-family:"Space Grotesk", Inter, sans-serif; font-weight:700; letter-spacing:.06em;
      font-size: min(12vw, 120px); line-height:1; text-align:center; text-transform:uppercase;
      color: transparent; -webkit-text-stroke: 1px rgba(180,200,255,.08);
      text-shadow: 0 0 60px rgba(124,170,255,.06);
      white-space:pre-wrap; padding:3rem; user-select:none;
    }

    /* header */
    header{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(6,10,32,.8), rgba(6,10,32,0));
      border-bottom:1px solid rgba(86,106,180,.15);
    }
    .nav{
      max-width:1200px; margin:0 auto; padding:14px 20px; display:flex; align-items:center; gap:12px;
      justify-content:space-between;
    }
    .logo{display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.02em}
    .logo .mark{width:28px; height:28px; border-radius:8px; background: conic-gradient(from 0deg, var(--brand), var(--brand-2), var(--accent), var(--brand)); box-shadow: 0 0 24px rgba(124,170,255,.35) inset, 0 6px 20px rgba(67,151,255,.25);}
    .nav a{color:var(--muted); text-decoration:none; font-size:.95rem}
    .nav a:hover{color:#dfe7ff}
    .cta{display:flex; gap:10px}
    .btn{appearance:none; border:1px solid var(--stroke); background:#0d1330; color:var(--ink); padding:10px 14px; border-radius:12px; font-weight:600; transition:all .2s; text-decoration:none}
    .btn.primary{border-color:transparent; background: linear-gradient(90deg, var(--brand), var(--brand-2)); box-shadow: 0 10px 24px rgba(100,140,255,.25)}
    .btn:hover{transform: translateY(-1px)}

    /* hero */
    .hero{position:relative; z-index:2}
    .shell{max-width:1200px; margin:0 auto; padding: clamp(24px, 4vw, 40px);}
    .hero-grid{display:grid; grid-template-columns:1.2fr .8fr; gap:30px; align-items:center}
    @media (max-width: 980px){.hero-grid{grid-template-columns:1fr}}

    .title{
      font-family:"Space Grotesk", Inter, sans-serif; font-weight:700; font-size:clamp(32px, 6vw, 56px);
      line-height:1.05; margin:18px 0; letter-spacing:.02em;
    }
    .title .grad{background: linear-gradient(90deg, var(--brand) 0%, var(--accent) 60%, var(--brand-2) 100%); -webkit-background-clip:text; background-clip:text; color:transparent}
    .lead{color:var(--muted); font-size:clamp(16px, 2.2vw, 18px)}

    .hero-card{
      background: radial-gradient(100% 140% at 100% 0%, rgba(124,164,255,.18), transparent 50%), var(--card);
      border:1px solid rgba(124,164,255,.18); border-radius:20px; padding:20px; box-shadow: 0 20px 60px rgba(10, 20, 60, .45);
    }
    .mini-row{display:flex; gap:12px; flex-wrap:wrap; margin-top:14px}
    .pill{font-size:.85rem; color:#d8e2ff; background:#0a1033; padding:8px 10px; border-radius:999px; border:1px solid rgba(124,164,255,.2)}

    /* 3D Bots stage */
    .stage{position:fixed; inset:0; pointer-events:none; z-index:2; perspective:1000px; overflow:hidden}
    .bots{position:absolute; inset:0; transform-style:preserve-3d}
    .bot{position:absolute; width:56px; height:56px; transform-style:preserve-3d; filter: drop-shadow(0 8px 16px rgba(0,0,0,.35));
         animation: float var(--dur) ease-in-out infinite alternate, spin calc(var(--dur) * 2.2) linear infinite}
    .bot .head{position:absolute; inset:0; border-radius:50%;
      background: radial-gradient(45% 45% at 30% 30%, #ffffff 0%, #e3efff 28%, #c7d9ff 48%, #9cb3ff 70%, #6b76c9 100%);
      box-shadow: inset -10px -10px 30px rgba(30,40,92,.5), inset 10px 10px 24px rgba(255,255,255,.35);
      border:1px solid rgba(255,255,255,.35);
    }
    .bot .visor{position:absolute; left:10px; right:10px; top:18px; height:16px; border-radius:12px;
      background: linear-gradient(180deg, rgba(10,20,40,.8), rgba(10,20,40,.4));
      border:1px solid rgba(172,196,255,.35);
      display:flex; align-items:center; justify-content:center;
    }
    .bot .eye{width:8px; height:8px; border-radius:50%; margin:0 3px; background: radial-gradient(circle at 30% 30%, #9ff 0%, #39d 40%, #124 100%); box-shadow:0 0 8px rgba(120,220,255,.8)}
    .bot .antenna{position:absolute; left:50%; top:-8px; width:2px; height:14px; background:linear-gradient(180deg, #8aa4ff, #2a2f66); transform: translateX(-50%) rotateX(18deg)}
    .bot .antenna::after{content:""; position:absolute; top:-6px; left:50%; width:8px; height:8px; transform:translateX(-50%);
      border-radius:50%; background: radial-gradient(circle at 35% 35%, #fff, #9ad7ff 40%, #5b6dd8 100%); box-shadow:0 0 16px rgba(100,180,255,.8)}

    @keyframes float{from{transform:translate3d(var(--x), var(--y), var(--z))} to{transform:translate3d(calc(var(--x) + var(--dx)), calc(var(--y) + var(--dy)), calc(var(--z) + 40px))}}
    @keyframes spin{to{transform: rotateY(360deg) translateZ(0)}}

    /* feature cards */
    .grid{display:grid; grid-template-columns:repeat(12, 1fr); gap:16px}
    .card{grid-column: span 4; min-height:170px; padding:18px; background: var(--card); border:1px solid rgba(124,164,255,.18); border-radius:18px}
    .card h3{margin:6px 0 8px; font-family:"Space Grotesk"; font-size:1.15rem}
    .card p{margin:0; color:var(--muted)}
    @media (max-width: 960px){.card{grid-column: span 6}}
    @media (max-width: 640px){.card{grid-column: span 12}}

    /* demo panel */
    .panel{margin-top:22px; display:grid; grid-template-columns: 1fr 1fr; gap:18px}
    .pane{background: var(--card); border:1px solid rgba(124,164,255,.18); border-radius:18px; padding:16px}
    .pane h4{margin:2px 0 10px; font-family:"Space Grotesk"}
    .pane .row{display:flex; gap:10px; flex-wrap:wrap}
    .input, .textarea{width:100%; background:#0b112e; color:#e9efff; border:1px solid rgba(124,164,255,.22); border-radius:12px; padding:10px 12px; font-family:inherit}
    .textarea{min-height:132px; resize:vertical}

    /* quick ask */
    .quick{margin-top:18px; background: var(--card); border:1px solid rgba(124,164,255,.18); border-radius:16px; padding:12px}
    .quick-row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .file-btn{position:relative; overflow:hidden;}
    .file-btn input[type=file]{position:absolute; inset:0; opacity:0; cursor:pointer}

    footer{margin-top:40px; padding:24px 0; border-top:1px solid rgba(86,106,180,.2); color:#b9c5ff}
    .foot{max-width:1200px; margin:0 auto; padding: 0 20px; display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:10px}
    .subtle{color:#9fb0ff; font-size:.95rem}

    /* subtle grid lines */
    .gridlines{position:fixed; inset:0; background-image: linear-gradient(to right, rgba(120,140,200,.06) 1px, transparent 1px), linear-gradient(to bottom, rgba(120,140,200,.06) 1px, transparent 1px); background-size: 80px 80px; mask-image: radial-gradient(80% 60% at 50% 40%, black, transparent 75%); pointer-events:none; z-index:1}
  </style>
</head>
<body>
  <div class="noise" aria-hidden="true"></div>
  <div class="gridlines" aria-hidden="true"></div>
  <div class="watermark">Maritime\nVirtual Assistant</div>

  <div class="stage" aria-hidden="true">
    <div class="bots" id="bots"></div>
  </div>

  <header>
    <nav class="nav">
      <div class="logo"><div class="mark" aria-hidden="true"></div> Maritime VA</div>
      <div class="cta">
        <a class="btn" href="#features">Features</a>

      </div>
    </nav>
  </header>

  <main class="hero">
    <section class="shell">
      <div class="hero-grid">
        <div class="hero-copy">
          <div class="pill" style="display:inline-flex; align-items:center; gap:8px">⚓️ <span>Smart Maritime AI</span></div>
          <h1 class="title">Your <span class="grad">Maritime Virtual Assistant</span> for contracts, docs, and voyage tools.</h1>
          <p class="lead">Upload voyage files, charter parties, statements of facts, and images; then ask questions in plain language. Includes a simple Distance/ETA tool and citations.</p>

          <form class="quick" id="quick">
            <label for="q" class="subtle">Ask a question</label>
            <div class="quick-row">
              <input class="input" id="q" placeholder="e.g., Summarize laytime terms and demurrage..." aria-label="Question" />
              <label class="btn file-btn" for="files">Upload<input type="file" id="files" multiple accept=".pdf,.png,.jpg,.jpeg,.md,.txt" /></label>
              <button class="btn primary" id="askBtn" type="button">Ask</button>
              <span id="fileInfo" class="subtle" aria-live="polite"></span>
            </div>
          </form>
        </div>

      </div>

      <section id="features" class="shell" style="padding: 8px 0 0">
        <div class="grid">
          <div class="card">
            <h3>Document QA</h3>
            <p>Ask contract terms, laytime clauses, or demurrage summaries. Answers cite source files for traceability.</p>
          </div>
          <div class="card">
            <h3>Smart Ingestion</h3>
            <p>Drop PDFs, images, or Markdown. Convert to text, chunk, index — then query with semantic search.</p>
          </div>
          <div class="card">
            <h3>Voyage Tools</h3>
            <p>Quick distance and ETA calculator with great UX. Extend with port DBs, weather, and routing.</p>
          </div>
        </div>


          </div>
          <div class="pane">
            <h4>Answer</h4>
            <textarea class="textarea" id="a" placeholder="Answer appears here..." aria-label="Answer" readonly></textarea>
          </div>
        </div>
      </section>


    </section>
  </main>

  <footer>
    <div class="foot shell">
      <div>© <span id="yr"></span> Maritime Virtual Assistant</div>
      <div class="subtle">Built with ❤️ — responsive, accessible, and fast.</div>
    </div>
  </footer>

  <script>
    // Footer year
    document.getElementById('yr').textContent = new Date().getFullYear();

    // File upload filename preview (no backend calls here)
    const filesInput = document.getElementById('files');
    const fileInfo = document.getElementById('fileInfo');
    filesInput?.addEventListener('change', () => {
      const n = filesInput.files?.length || 0;
      if(!n){ fileInfo.textContent = ''; return; }
      const names = Array.from(filesInput.files).slice(0,3).map(f=>f.name);
      fileInfo.textContent = n > 3 ? `${names.join(', ')} + ${n-3} more` : names.join(', ');
    });

    // === 3D Small Bots =====================================================
    const STAGE = document.getElementById('bots');
    const BOT_COUNT = 14; // tweak: how many bots
    const W = window.innerWidth; const H = window.innerHeight;

    function rand(min, max){ return Math.random()*(max-min)+min; }

    function makeBot(){
      const b = document.createElement('div');
      b.className = 'bot';
      const dur = rand(4, 9).toFixed(2) + 's';
      const x = rand(-40, W-40) + 'px';
      const y = rand(-20, H-60) + 'px';
      const z = rand(-200, 140) + 'px';
      const dx = rand(-30, 40) + 'px';
      const dy = rand(-25, 35) + 'px';
      b.style.setProperty('--dur', dur);
      b.style.setProperty('--x', x);
      b.style.setProperty('--y', y);
      b.style.setProperty('--z', z);
      b.style.setProperty('--dx', dx);
      b.style.setProperty('--dy', dy);

      b.innerHTML = `
        <div class="head"></div>
        <div class="antenna"></div>
        <div class="visor">
          <div class="eye"></div>
          <div class="eye"></div>
        </div>
      `;
      return b;
    }

    for(let i=0;i<BOT_COUNT;i++) STAGE.appendChild(makeBot());

    // Subtle parallax on cursor
    let px = 0, py = 0;
    document.addEventListener('pointermove', (e)=>{
      const cx = e.clientX / window.innerWidth - .5;
      const cy = e.clientY / window.innerHeight - .5;
      px = cx * 18; py = cy * 14;
      STAGE.style.transform = `translate3d(${px}px, ${py}px, 0)`;
    });

    // Adjust on resize
    window.addEventListener('resize', ()=>{
      const bots = Array.from(document.querySelectorAll('.bot'));
      bots.forEach(b=> b.remove());
      for(let i=0;i<BOT_COUNT;i++) STAGE.appendChild(makeBot());
    });

    // === API Communication =================================================
    const askBtn = document.getElementById('askBtn');
    const qInput = document.getElementById('q');
    const aTextarea = document.getElementById('a');

    askBtn.addEventListener('click', async () => {
      const question = qInput.value.trim();
      const files = filesInput.files;

      if (!question) {
        aTextarea.value = "Please enter a question.";
        return;
      }

      askBtn.disabled = true;
      askBtn.textContent = 'Thinking...';
      aTextarea.value = 'Processing...';

      try {
        // Step 1: Upload files if they exist
        if (files.length > 0) {
          const formData = new FormData();
          for (const file of files) {
            formData.append('files', file);
          }
          const uploadResponse = await fetch('/upload', {
            method: 'POST',
            body: formData
          });
          if (!uploadResponse.ok) {
            const error = await uploadResponse.json();
            throw new Error(`File upload failed: ${error.detail}`);
          }
          const uploadResult = await uploadResponse.json();
          console.log('Uploaded files:', uploadResult.ingested_files);
        }

        // Step 2: Ask the question
        const chatResponse = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question: question })
        });

        if (!chatResponse.ok) {
          const error = await chatResponse.json();
          throw new Error(`API error: ${error.detail}`);
        }

        const result = await chatResponse.json();
        aTextarea.value = result.answer;
        if (result.citations && result.citations.length > 0) {
            aTextarea.value += `\n\nCitations: ${result.citations.join(', ')}`;
        }

      } catch (error) {
        aTextarea.value = `Error: ${error.message}`;
      } finally {
        askBtn.disabled = false;
        askBtn.textContent = 'Ask';
      }
    });
  </script>
</body>
</html>
